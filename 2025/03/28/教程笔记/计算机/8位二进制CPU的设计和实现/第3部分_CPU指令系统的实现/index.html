<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"staraire.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="第三部分 CPU指令系统的实现 本文是对B站UP踌躇月光出的8位二进制CPU的设计和实现的文字教程复现第三部分 CPU指令系统的实现相关 github 地址：https:&#x2F;&#x2F;github.com&#x2F;StevenBaby&#x2F;computerPS：有错误的地方请指正，谢谢！共同学习，一起进步！  指令系统">
<meta property="og:type" content="article">
<meta property="og:title" content="《8位二进制CPU的设计和实现》第三部分 CPU指令系统的实现">
<meta property="og:url" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/index.html">
<meta property="og:site_name" content="StarAire&#39;s Blog">
<meta property="og:description" content="第三部分 CPU指令系统的实现 本文是对B站UP踌躇月光出的8位二进制CPU的设计和实现的文字教程复现第三部分 CPU指令系统的实现相关 github 地址：https:&#x2F;&#x2F;github.com&#x2F;StevenBaby&#x2F;computerPS：有错误的地方请指正，谢谢！共同学习，一起进步！  指令系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/1.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/2.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/3.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/4.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/5.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/6.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/7.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/8.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/9.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/10.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/11.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/12.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/13.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/14.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/15.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/16.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/17.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/18.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/19.png">
<meta property="og:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/20.png">
<meta property="article:published_time" content="2025-03-28T08:00:02.000Z">
<meta property="article:modified_time" content="2025-03-28T01:28:35.077Z">
<meta property="article:author" content="StarAire">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/1.png">


<link rel="canonical" href="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/","path":"2025/03/28/教程笔记/计算机/8位二进制CPU的设计和实现/第3部分_CPU指令系统的实现/","title":"《8位二进制CPU的设计和实现》第三部分 CPU指令系统的实现"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>《8位二进制CPU的设计和实现》第三部分 CPU指令系统的实现 | StarAire's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">StarAire's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.</span> <span class="nav-text">第三部分 CPU指令系统的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.1.</span> <span class="nav-text">指令系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">1.1.1.</span> <span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F-1"><span class="nav-number">1.1.2.</span> <span class="nav-text">指令系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F-2-x-3bit"><span class="nav-number">1.1.3.</span> <span class="nav-text">寻址方式 2 x 3bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E7%8A%B6%E6%80%81%E5%AD%97-4bit"><span class="nav-number">1.1.4.</span> <span class="nav-text">程序状态字 4bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%92%9F%E5%91%A8%E6%9C%9F-4bit"><span class="nav-number">1.1.5.</span> <span class="nav-text">时钟周期 4bit</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.2.</span> <span class="nav-text">寄存器控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PC%E8%AE%A1%E6%95%B0%E5%99%A8%E6%94%B9%E9%80%A0"><span class="nav-number">1.2.1.</span> <span class="nav-text">PC计数器改造</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#532%E8%AF%91%E7%A0%81%E5%99%A8%E5%92%8C32%E4%BD%8D%E5%BC%82%E6%88%96%E9%97%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text">532译码器和32位异或门</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E6%8E%A7%E5%88%B6%E5%99%A8-1"><span class="nav-number">1.2.3.</span> <span class="nav-text">寄存器控制器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU%E6%A1%86%E6%9E%B6"><span class="nav-number">1.3.</span> <span class="nav-text">CPU框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.4.</span> <span class="nav-text">CPU控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E8%AF%BB%E5%86%99%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.4.1.</span> <span class="nav-text">寄存器读写控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E6%8C%87%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.4.2.</span> <span class="nav-text">取指系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%96%E6%8C%87%E4%BB%A4%E5%BE%AE%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.5.</span> <span class="nav-text">取指令微程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.5.1.</span> <span class="nav-text">指令设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.5.2.</span> <span class="nav-text">程序设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E4%B8%8B%E8%BD%BD"><span class="nav-number">1.5.3.</span> <span class="nav-text">编译下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%90%E8%A1%8C"><span class="nav-number">1.5.4.</span> <span class="nav-text">启动运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="nav-number">1.6.</span> <span class="nav-text">指令集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MOV%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.1.</span> <span class="nav-text">MOV指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">生成指令集</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-number">1.6.2.</span> <span class="nav-text">汇编编译器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.3.</span> <span class="nav-text">数据传送指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.4.</span> <span class="nav-text">算术运算指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.5.</span> <span class="nav-text">逻辑运算指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E8%AE%B0%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.6.</span> <span class="nav-text">标记转移指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.7.</span> <span class="nav-text">条件转移指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.8.</span> <span class="nav-text">堆栈操作指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.9.</span> <span class="nav-text">函数调用指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E4%B8%AD%E6%96%AD%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.10.</span> <span class="nav-text">内中断指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8B%98%E8%AF%AF-%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E4%BD%8D"><span class="nav-number">1.7.</span> <span class="nav-text">勘误-奇偶校验位</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="StarAire"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">StarAire</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/staraire" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;staraire" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="StarAire">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="StarAire's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="《8位二进制CPU的设计和实现》第三部分 CPU指令系统的实现 | StarAire's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《8位二进制CPU的设计和实现》第三部分 CPU指令系统的实现
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-03-28 08:00:02 / 修改时间：01:28:35" itemprop="dateCreated datePublished" datetime="2025-03-28T08:00:02+00:00">2025-03-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">教程笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>24 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="第三部分-CPU指令系统的实现"><a href="#第三部分-CPU指令系统的实现" class="headerlink" title="第三部分 CPU指令系统的实现"></a>第三部分 CPU指令系统的实现</h1><blockquote>
<p>本文是对B站UP<a target="_blank" rel="noopener" href="https://space.bilibili.com/491131440">踌躇月光</a>出的<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1aP4y1s7Vf">8位二进制CPU的设计和实现</a>的文字教程复现第三部分 CPU指令系统的实现<br>相关 github 地址：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer">https://github.com/StevenBaby/computer</a><br>PS：有错误的地方请指正，谢谢！共同学习，一起进步！</p>
</blockquote>
<h2 id="指令系统"><a href="#指令系统" class="headerlink" title="指令系统"></a>指令系统</h2><blockquote>
<p>如第二部分所述，我们实现了一些自动运算的电路部分。但是对于一个CPU来说，这些功能还不算完全。<br>因此，这一部分，我们将从一个整体的角度去考虑如何设计CPU的指令系统和相应的电路。</p>
</blockquote>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><blockquote>
<p>以下是CPU需要使用的寄存器，我们需要设计电路来控制这些寄存器</p>
</blockquote>
<ul>
<li><p><code>PC</code> 程序计数器</p>
</li>
<li><p><code>ALU</code></p>
</li>
<li><p><code>PSW/FLAG</code> 程序状态字</p>
</li>
<li><p><code>A</code> 寄存器</p>
</li>
<li><p><code>B</code> 寄存器</p>
</li>
<li><p><code>C</code> 寄存器</p>
</li>
<li><p><code>D</code> 寄存器</p>
</li>
<li><p><code>IR</code> 指令寄存器</p>
</li>
<li><p><code>DST</code> 目的操作数寄存器</p>
</li>
<li><p><code>SRC</code> 目的操作数寄存器</p>
</li>
<li><p><code>MSR</code> 存储器段寄存器</p>
</li>
<li><p><code>MAR</code> 存储器地址寄存器</p>
</li>
<li><p><code>MDR</code> 存储器数据寄存器</p>
</li>
<li><p><code>MC</code> 内存寄存器</p>
</li>
<li><p><code>SP</code> 堆栈指针寄存器</p>
</li>
<li><p><code>BP</code> 基址寄存器</p>
</li>
<li><p><code>SI</code> 源变址寄存器</p>
</li>
<li><p><code>DI</code> 目的变址寄存器</p>
</li>
<li><p><code>CS</code> 代码段寄存器</p>
</li>
<li><p><code>DS</code> 数据段寄存器</p>
</li>
<li><p><code>SS</code> 堆栈段寄存器</p>
</li>
<li><p><code>ES</code> 附加段寄存器</p>
</li>
<li><p><code>TMP</code> 临时寄存器若干</p>
</li>
</ul>
<h3 id="指令系统-1"><a href="#指令系统-1" class="headerlink" title="指令系统"></a>指令系统</h3><blockquote>
<p>除了寄存器，还有一套控制指令</p>
</blockquote>
<ul>
<li>二操作数：3bit 最高位为1<ul>
<li><code>mov dst , src</code></li>
<li><code>add dst , src</code></li>
<li><code>sub dst , src</code></li>
<li><code>cmp dst , src</code></li>
<li><code>and dst , src</code></li>
<li><code>or dst , src</code></li>
<li><code>xor dst , src</code></li>
</ul>
</li>
<li>一操作数：此最高位为1<ul>
<li><code>inc src</code>  // 可用add实现</li>
<li><code>dec src</code> // 可用sub实现</li>
<li><code>not src</code></li>
<li><code>call src</code></li>
<li><code>jmp dst</code></li>
<li><code>jo dst</code></li>
<li><code>jno dst</code></li>
<li><code>jz dst</code></li>
<li><code>jnz dst</code></li>
<li><code>push src</code></li>
<li><code>pop src</code></li>
<li><code>int dst</code></li>
</ul>
</li>
<li>零操作数：<ul>
<li><code>nop</code></li>
<li><code>hlt</code></li>
<li><code>ret</code></li>
<li><code>iret</code></li>
</ul>
</li>
</ul>
<h3 id="寻址方式-2-x-3bit"><a href="#寻址方式-2-x-3bit" class="headerlink" title="寻址方式 2 x 3bit"></a>寻址方式 2 x 3bit</h3><ul>
<li>立即寻址 <code>MOV A , 5</code></li>
<li>寄存器寻址 <code>MOV A , B</code></li>
<li>直接寻址 <code>MOV A , [5]</code></li>
<li>寄存器间接寻址 <code>MOV A , [B]</code></li>
</ul>
<h3 id="程序状态字-4bit"><a href="#程序状态字-4bit" class="headerlink" title="程序状态字 4bit"></a>程序状态字 4bit</h3><ul>
<li><code>OF</code> 溢出标志</li>
<li><code>ZF</code> 零标志</li>
<li><code>PF</code> 奇偶标志</li>
<li><code>IF</code> 中断标志</li>
</ul>
<h3 id="时钟周期-4bit"><a href="#时钟周期-4bit" class="headerlink" title="时钟周期 4bit"></a>时钟周期 4bit</h3><h2 id="寄存器控制器"><a href="#寄存器控制器" class="headerlink" title="寄存器控制器"></a>寄存器控制器</h2><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/23%20%E5%AF%84%E5%AD%98%E5%99%A8%E6%8E%A7%E5%88%B6%E5%99%A8">23 寄存器控制器</a></strong></em></p>
<h3 id="PC计数器改造"><a href="#PC计数器改造" class="headerlink" title="PC计数器改造"></a>PC计数器改造</h3><blockquote>
<p>因为ALU经常变动，这里将PC计数器里的自增单元从ALU改为8位加法器</p>
</blockquote>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/1.png" class="">


<blockquote>
<p>在前一部分，我们控制寄存器采用的方案是将16位进行分割，这样假设全是控制寄存器也只能控制8个寄存器，就算是用32位也只能控制16个，而我们需要控制的光是寄存器就达到了二十多个，显然是不够用的。</p>
</blockquote>
<blockquote>
<p>因为每次数据交换只需要使用两个器件，所以我们在这里采用压缩编码的方式：采用5-32译码器来通过5位控制32位，10位可以控制64位！！这样就够我们使用了</p>
</blockquote>
<blockquote>
<p>我们创建两个五位输入端，一个是W，也就是写端，还有一个是R，也就是读，这样可以分开控制两个器件，让一个写一个读即可完成数据交换。(寄存器也是两个功能：写和读)</p>
</blockquote>
<h3 id="532译码器和32位异或门"><a href="#532译码器和32位异或门" class="headerlink" title="532译码器和32位异或门"></a>532译码器和32位异或门</h3><blockquote>
<p>利用和38译码器同样的方式，我们制作一个532译码器</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">dirname = os.path.direname(__file__)</span><br><span class="line">filename = os.path.join(dirname,<span class="string">'532decoder.bin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename,<span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        value = <span class="number">1</span>&lt;&lt;var</span><br><span class="line">        result = value.to_bytes(<span class="number">4</span>,byteorder=<span class="string">'little'</span>)</span><br><span class="line">        file.write(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/2.png" class="">

<blockquote>
<p>为了防止单个器件同时读和写的情况，这里给 W 和 R 加上一个异或门(相同则输出0)</p>
</blockquote>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/3.png" class="">

<h3 id="寄存器控制器-1"><a href="#寄存器控制器-1" class="headerlink" title="寄存器控制器"></a>寄存器控制器</h3><blockquote>
<p>寄存器控制器设计电路如下</p>
</blockquote>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/4.png" class="">

<p>可以看一下，第三个是<code>MDR</code>，第九个是<code>B</code>，寄存器的两位分别是WE和CS，读是WE=0，CS=1;写是WE=1，CS=1;</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/5.png" class="">


<h2 id="CPU框架"><a href="#CPU框架" class="headerlink" title="CPU框架"></a>CPU框架</h2><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/24%20CPU%E6%A1%86%E6%9E%B6">24 CPU框架</a></strong></em></p>
<blockquote>
<p>这一节我们将所有寄存器，运算单元和计数器全部放到总线上</p>
</blockquote>
<p>首先将 寄存器的<code>WE</code>和<code>CS</code>汇总成两位，<code>CS</code>为高位，<code>WE</code>为低位</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/6.png" class="">


<p><em><strong>寄存器连接总线通用方法</strong></em>：除了特殊的，一律是 <code>DI</code> 和 <code>DO</code> 接数据总线，<code>CP</code>接时钟线，<code>Clear</code>接复位线，<code>Pre不</code>接，<code>IO</code>接CPU控制单元，<code>S</code>不接(接探针)</p>
<ul>
<li><code>MDR</code>、<code>C</code>、<code>D</code>、<code>CS</code>、<code>DS</code>、<code>SS</code>、<code>ES</code>、<code>DI</code>、<code>SI</code>、<code>SP</code>、<code>BP</code>、<code>VEC</code>、<code>T1</code>、<code>T2</code>寄存器全部按照通用方法接线，<code>程序计数器PC</code>也按照通用方法接线</li>
</ul>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/7.png" class="">


<ul>
<li><code>MSR</code>、<code>MAR</code>合并为16位地址进行RAM寻址</li>
</ul>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/8.png" class="">

<ul>
<li>寄存器<code>A</code>和<code>B</code>接到<code>ALU</code>的输入端</li>
</ul>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/9.png" class=""> 

<ul>
<li>寄存器<code>IR</code>、<code>DST</code>、<code>SRC</code>的S接到控制单元，这个后面会提到</li>
</ul>
<p>以上就是寄存器挂 到总线的方式(注意特殊的地方)</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/10.png" class="">


<h2 id="CPU控制器"><a href="#CPU控制器" class="headerlink" title="CPU控制器"></a>CPU控制器</h2><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/25%20CPU%E6%8E%A7%E5%88%B6%E5%99%A8">25 CPU控制器</a></strong></em></p>
<blockquote>
<p>这一节比较复杂，一定要认真研究，先看一下总览图</p>
</blockquote>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/11.png" class="">

<h3 id="寄存器读写控制器"><a href="#寄存器读写控制器" class="headerlink" title="寄存器读写控制器"></a>寄存器读写控制器</h3><blockquote>
<p>前一节CPU框架介绍了寄存器读写总线是如何建立的，读写控制器的作用是三选一</p>
</blockquote>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/12.png" class="">


<h3 id="取指系统"><a href="#取指系统" class="headerlink" title="取指系统"></a>取指系统</h3><img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/13.png" class="">



<p>将CPU控制器接入整个系统</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/14.png" class="">


<h2 id="取指令微程序"><a href="#取指令微程序" class="headerlink" title="取指令微程序"></a>取指令微程序</h2><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/26%20%E5%8F%96%E6%8C%87%E4%BB%A4%E5%BE%AE%E7%A8%8B%E5%BA%8F">26 取指令微程序</a></strong></em></p>
<blockquote>
<p>回顾第二部分我们搭建的那个小型自动电路用来完成某项任务所写的微程序</p>
</blockquote>
<blockquote>
<p>现在我们 为上面这样一个完整的CPU来写一个微程序完成以下任务：</p>
</blockquote>
<blockquote>
<p><em><strong>任务描述：将RAM中0地址 1地址 2地址数据分别取出放入IR DST SRC寄存器中。</strong></em></p>
</blockquote>
<h3 id="指令设计"><a href="#指令设计" class="headerlink" title="指令设计"></a>指令设计</h3><figure class="highlight py"><figcaption><span>pin.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line">MSR = <span class="number">1</span></span><br><span class="line">MAR = <span class="number">2</span></span><br><span class="line">MDR = <span class="number">3</span></span><br><span class="line">RAM = <span class="number">4</span></span><br><span class="line">IR = <span class="number">5</span></span><br><span class="line">DST = <span class="number">6</span></span><br><span class="line">SRC = <span class="number">7</span></span><br><span class="line">A = <span class="number">8</span></span><br><span class="line">B = <span class="number">9</span></span><br><span class="line">C = <span class="number">10</span></span><br><span class="line">D = <span class="number">11</span></span><br><span class="line">DI = <span class="number">12</span></span><br><span class="line">SI = <span class="number">13</span></span><br><span class="line">SP = <span class="number">14</span></span><br><span class="line">BP = <span class="number">15</span></span><br><span class="line">CS = <span class="number">16</span></span><br><span class="line">DS = <span class="number">17</span></span><br><span class="line">SS = <span class="number">18</span></span><br><span class="line">ES = <span class="number">19</span></span><br><span class="line">VEC = <span class="number">20</span></span><br><span class="line">T1 = <span class="number">21</span></span><br><span class="line">T2 = <span class="number">22</span></span><br><span class="line"></span><br><span class="line">MSR_OUT = MSR</span><br><span class="line">MAR_OUT = MAR</span><br><span class="line">MDR_OUT = MDR</span><br><span class="line">RAM_OUT = RAM</span><br><span class="line">IR_OUT = IR</span><br><span class="line">DST_OUT = DST</span><br><span class="line">SRC_OUT = SRC</span><br><span class="line">A_OUT = A</span><br><span class="line">B_OUT = B</span><br><span class="line">C_OUT = C</span><br><span class="line">D_OUT = D</span><br><span class="line">DI_OUT = DI</span><br><span class="line">SI_OUT = SI</span><br><span class="line">SP_OUT = SP</span><br><span class="line">BP_OUT = BP</span><br><span class="line">CS_OUT = CS</span><br><span class="line">DS_OUT = DS</span><br><span class="line">SS_OUT = SS</span><br><span class="line">ES_OUT = ES</span><br><span class="line">VEC_OUT = VEC</span><br><span class="line">T1_OUT = T1</span><br><span class="line">T2_OUT = T2</span><br><span class="line"></span><br><span class="line">_DST_SHIFT = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">MSR_IN = MSR &lt;&lt; _DST_SHIFT</span><br><span class="line">MAR_IN = MAR &lt;&lt; _DST_SHIFT</span><br><span class="line">MDR_IN = MDR &lt;&lt; _DST_SHIFT</span><br><span class="line">RAM_IN = RAM &lt;&lt; _DST_SHIFT</span><br><span class="line">IR_IN = IR &lt;&lt; _DST_SHIFT</span><br><span class="line">DST_IN = DST &lt;&lt; _DST_SHIFT</span><br><span class="line">SRC_IN = SRC &lt;&lt; _DST_SHIFT</span><br><span class="line">A_IN = A &lt;&lt; _DST_SHIFT</span><br><span class="line">B_IN = B &lt;&lt; _DST_SHIFT</span><br><span class="line">C_IN = C &lt;&lt; _DST_SHIFT</span><br><span class="line">D_IN = D &lt;&lt; _DST_SHIFT</span><br><span class="line">DI_IN = DI &lt;&lt; _DST_SHIFT</span><br><span class="line">SI_IN = SI &lt;&lt; _DST_SHIFT</span><br><span class="line">SP_IN = SP &lt;&lt; _DST_SHIFT</span><br><span class="line">BP_IN = BP &lt;&lt; _DST_SHIFT</span><br><span class="line">CS_IN = CS &lt;&lt; _DST_SHIFT</span><br><span class="line">DS_IN = DS &lt;&lt; _DST_SHIFT</span><br><span class="line">SS_IN = SS &lt;&lt; _DST_SHIFT</span><br><span class="line">ES_IN = ES &lt;&lt; _DST_SHIFT</span><br><span class="line">VEC_IN = VEC &lt;&lt; _DST_SHIFT</span><br><span class="line">T1_IN = T1 &lt;&lt; _DST_SHIFT</span><br><span class="line">T2_IN = T2 &lt;&lt; _DST_SHIFT</span><br><span class="line"></span><br><span class="line">SRC_R = <span class="number">2</span> ** <span class="number">10</span></span><br><span class="line">SRC_W = <span class="number">2</span> ** <span class="number">11</span></span><br><span class="line">DST_R = <span class="number">2</span> ** <span class="number">12</span></span><br><span class="line">DST_W = <span class="number">2</span> ** <span class="number">13</span></span><br><span class="line"></span><br><span class="line">PC_WE = <span class="number">2</span> ** <span class="number">14</span></span><br><span class="line">PC_CS = <span class="number">2</span> ** <span class="number">15</span></span><br><span class="line">PC_EN = <span class="number">2</span> ** <span class="number">16</span></span><br><span class="line"></span><br><span class="line">PC_OUT = PC_CS</span><br><span class="line">PC_IN = PC_CS | PC_WE</span><br><span class="line">PC_INC = PC_CS | PC_WE | PC_EN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HLT = <span class="number">2</span> ** <span class="number">31</span></span><br></pre></td></tr></table></figure>

<p><code>OUT</code>指读寄存器即将寄存器数据送到总线，<code>IN</code>指写寄存器，<code>W</code>处于高五位，<code>R</code>处于低五位</p>
<h3 id="程序设计"><a href="#程序设计" class="headerlink" title="程序设计"></a>程序设计</h3><figure class="highlight py"><figcaption><span>assembly.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pin</span><br><span class="line"></span><br><span class="line">FETCH = [</span><br><span class="line">    pin.PC_OUT | pin.MAR_IN,</span><br><span class="line">    pin.RAM_OUT | pin.IR_IN | pin.PC_INC,</span><br><span class="line">    pin.PC_OUT | pin.MAR_IN,</span><br><span class="line">    pin.RAM_OUT | pin.DST_IN | pin.PC_INC,</span><br><span class="line">    pin.PC_OUT | pin.MAR_IN,</span><br><span class="line">    pin.RAM_OUT | pin.SRC_IN | pin.PC_INC,</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><code>pin.PC_OUT | pin.MAR_IN</code> 程序计数器<code>PC</code>的数送到存储器地址寄存器<code>MAR</code></li>
<li><code>pin.RAM_OUT | pin.IR_IN | pin.PC_INC</code> 存储器地址寄存器<code>MAR</code>指向<code>RAM</code>地址的数据送到指令寄存器<code>IR</code>，程序计数器<code>PC</code>+1</li>
<li><code>pin.PC_OUT | pin.MAR_IN</code> 程序计数器<code>PC</code>的数送到存储器地址寄存器<code>MAR</code></li>
<li><code>pin.RAM_OUT | pin.DST_IN | pin.PC_INC</code>存储器地址寄存器<code>MAR</code>指向<code>RAM</code>地址的数据送到目的数寄存器<code>DST</code>，程序计数器<code>PC</code>+1</li>
<li><code>pin.PC_OUT | pin.MAR_IN</code> 程序计数器<code>PC</code>的数送到存储器地址寄存器<code>MAR</code></li>
<li><code>pin.RAM_OUT | pin.SRC_IN | pin.PC_INC</code>存储器地址寄存器<code>MAR</code>指向<code>RAM</code>地址的数据送到目的数寄存器<code>SRC</code>，程序计数器<code>PC</code>+1</li>
</ul>
<h3 id="编译下载"><a href="#编译下载" class="headerlink" title="编译下载"></a>编译下载</h3><figure class="highlight py"><figcaption><span>controller.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pin</span><br><span class="line"><span class="keyword">import</span> assembly <span class="keyword">as</span> ASM</span><br><span class="line"></span><br><span class="line">dirname = os.path.dirname(__file__)</span><br><span class="line">filename = os.path.join(dirname, <span class="string">'micro.bin'</span>)</span><br><span class="line"></span><br><span class="line">micro = [pin.HLT <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000</span>)] <span class="comment"># 在ROM里写满HLT指令</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000</span>):</span><br><span class="line">    ir = addr &gt;&gt; <span class="number">8</span>            <span class="comment"># 从地址中取出IR即指令信息</span></span><br><span class="line">    psw = (addr &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>   <span class="comment"># 从地址中取出PSW即状态字信息</span></span><br><span class="line">    cyc = addr &amp; <span class="number">0xf</span>          <span class="comment"># 从地址中取出系统时钟周期信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cyc &lt; <span class="built_in">len</span>(ASM.FETCH):  <span class="comment"># 如果将指令一个个填充进去</span></span><br><span class="line">        micro[addr] = ASM.FETCH[cyc]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file: <span class="comment"># 转换成二进制</span></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> micro:</span><br><span class="line">        value = var.to_bytes(<span class="number">4</span>, byteorder=<span class="string">'little'</span>)</span><br><span class="line">        file.write(value)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Compile micro instruction finish!!!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将二进制文件下载进ROM里</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/15.png" class="">

<h3 id="启动运行"><a href="#启动运行" class="headerlink" title="启动运行"></a>启动运行</h3><img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/16.png" class="">

<p>取指令功能实现</p>
<h2 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h2><blockquote>
<p>我们知道存放程序(<code>ROM</code>)的地址有16位，高八位代表指令，中间四位代表状态字，后四位代表微程序的周期，即</p>
</blockquote>
<p>| 指令 IR 8位 | 程序状态字PSW | 微程序周期 |</p>
<ul>
<li>指令 <code>IR</code> 8位：最高支持<code>256</code>个指令</li>
<li>程序状态字<code>PSW</code></li>
<li>微程序周期 4位：单个指令的周期为<code>16</code>，就是支持<code>16</code>个微指令，不能超过<code>16</code>个</li>
</ul>
<blockquote>
<p>关于指令集，再说几点</p>
</blockquote>
<ul>
<li>上面的<code>ROM</code>里存放的就是<code>指令集</code></li>
<li>指令集最高支持<code>256</code>个指令，每个指令支持<code>16</code>个微指令</li>
<li>而我们的程序是写在<code>RAM</code>里的，<code>RAM</code>里存放的是指令，指令集里每个指令的前面几个微指令都会有把<code>RAM</code>里指令读出来的功能。</li>
</ul>
<h3 id="MOV指令"><a href="#MOV指令" class="headerlink" title="MOV指令"></a>MOV指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/27%20MOV%20%E6%8C%87%E4%BB%A4">27 MOV 指令</a></strong></em></p>
<p>假设指令为</p>
<p><code>MOV A , 5</code>：该指令为两种寻址方式：<code>寄存器寻址</code>和<code>立即寻址</code></p>
<hr>
<p>总共表示四种寻址方式：</p>
<ul>
<li>立即寻址 <code>MOV A , 5</code></li>
<li>寄存器寻址 <code>MOV A , B</code></li>
<li>直接寻址 <code>MOV A , [5]</code></li>
<li>寄存器间接寻址 <code>MOV A , [B]</code></li>
</ul>
<p><em><strong>我们做以下编码</strong></em>：</p>
<ul>
<li><code>立即寻址</code> = <code>0</code></li>
<li><code>寄存器寻址</code> = <code>1</code></li>
<li><code>直接寻址</code> = <code>2</code></li>
<li><code>寄存器间接寻址</code> = <code>3</code></li>
</ul>
<hr>
<p>对于不同长度的指令：</p>
<ul>
<li>二地址指令 <code>MOV A,B</code></li>
<li>一地址指令 <code>NOT A</code></li>
<li>零地址指令 <code>HLT</code></li>
</ul>
<p><em><strong>我们做以下编码</strong></em>：</p>
<ul>
<li>二地址指令<ul>
<li><code>1xxx [aa] [bb]</code> # 这里aa，bb均代表寻址方式</li>
</ul>
</li>
<li>一地址指令<ul>
<li><code>01xxxx[aa]</code> # 这里aa代表寻址方式</li>
</ul>
</li>
<li>零地址指令<ul>
<li><code>00xxxxxx</code></li>
</ul>
</li>
</ul>
<hr>
<p>根据以上编码原理，我们写下编译器预定义程序</p>
<figure class="highlight py"><figcaption><span>pin.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CYC = <span class="number">2</span> ** <span class="number">30</span></span><br><span class="line">HLT = <span class="number">2</span> ** <span class="number">31</span></span><br><span class="line"></span><br><span class="line"><span class="meta">... </span><span class="comment">#省略控制定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 指令长度定义</span></span><br><span class="line"></span><br><span class="line">ADDR2 = <span class="number">1</span> &lt;&lt; <span class="number">7</span> <span class="comment"># 二地址指令 1xxx xxxx</span></span><br><span class="line">ADDR1 = <span class="number">1</span> &lt;&lt; <span class="number">6</span> <span class="comment"># 一地址指令 01xx xxxx</span></span><br><span class="line"></span><br><span class="line">ADDR2_SHIFT = <span class="number">4</span> <span class="comment"># 二地址指令偏移</span></span><br><span class="line">ADDR1_SHIFT = <span class="number">2</span> <span class="comment"># 一地址指令偏移</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 寻址方式定义</span></span><br><span class="line"></span><br><span class="line">AM_INS = <span class="number">0</span> <span class="comment"># 立即寻址编号</span></span><br><span class="line">AM_REG = <span class="number">1</span> <span class="comment"># 寄存器寻址编号</span></span><br><span class="line">AM_DIR = <span class="number">2</span> <span class="comment"># 直接寻址编号</span></span><br><span class="line">AM_RAM = <span class="number">3</span> <span class="comment"># 寄存器间接寻址编号</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过上面我们可以定义汇编指令</p>
<figure class="highlight py"><figcaption><span>assembly.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MOV = <span class="number">0</span> | pin.ADDR2                       <span class="comment"># MOV指令定义位1000 xxxx</span></span><br><span class="line">ADD = (<span class="number">1</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2  <span class="comment"># ADD指令定义为 1001 xxxx</span></span><br><span class="line"></span><br><span class="line">NOP = <span class="number">0</span>     <span class="comment"># NOP指令定义为 0000 0000</span></span><br><span class="line">HLT = <span class="number">0x3f</span>  <span class="comment"># HLT指令定义为 0011 1111</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后我们对指令的寻址方式进行定义</p>
<figure class="highlight py"><figcaption><span>assembly.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">INSTRUCTIONS = {</span><br><span class="line">    <span class="number">2</span>: { <span class="comment"># 二操作数指令列表</span></span><br><span class="line">        MOV: { <span class="comment"># MOV指令寻址方式列表</span></span><br><span class="line">            (pin.AM_REG, pin.AM_INS): [  <span class="comment"># (寄存器寻址，立即寻址) 例如 MOV A,5</span></span><br><span class="line">                pin.DST_W | pin.SRC_OUT, <span class="comment"># 微指令：DST寄存器写，SRC读，SRC-&gt;DST，这里DST是控制寄存器写</span></span><br><span class="line">            ]</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    <span class="number">1</span>: {},<span class="comment"># 一操作数指令列表</span></span><br><span class="line">    <span class="number">0</span>: {  <span class="comment"># 零操作数指令列表</span></span><br><span class="line">        NOP: [</span><br><span class="line">            pin.CYC, <span class="comment"># 让指令周期清零，跳过这次指令</span></span><br><span class="line">        ],</span><br><span class="line">        HLT: [</span><br><span class="line">            pin.HLT, <span class="comment"># 指令停止</span></span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="生成指令集"><a href="#生成指令集" class="headerlink" title="生成指令集"></a>生成指令集</h4><blockquote>
<p>在看这段程序之前，我再强调一下几点概念<br>首先是指令，上面我们所做的事情都是在对指令进行编码，如<code>MOV</code>，我们编码为<code>1000 xxxx</code>，<code>MOV 寄存器，立即数</code> 我们编码为<code>1000 0100</code>，这样的编码是为了方便在将指令放在<code>RAM</code>中(同时在<code>ROM</code>指令集里寻找到相应的<code>微指令</code>)，我们将汇编语言如<code>MOV 寄存器，立即数</code>翻译成<code>1000 0100</code>称作编译，但是编译出来的<code>1000 0100</code>这样的机器语言仍然只是编码。真正的指令是存放在<code>CPU</code>内部的<code>ROM</code>指令集里的，我们需要用这个机器语言去找到对应的<code>微指令</code>。而这个微指令才是真正控制<code>CPU</code>里的所有资源的指令。</p>
</blockquote>
<blockquote>
<p>好了，接下来我们来看生成这样的指令集的程序</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pin</span><br><span class="line"><span class="keyword">import</span> assembly <span class="keyword">as</span> ASM</span><br><span class="line"></span><br><span class="line">dirname = os.path.dirname(__file__)</span><br><span class="line">filename = os.path.join(dirname, <span class="string">'micro.bin'</span>)</span><br><span class="line"></span><br><span class="line">micro = [pin.HLT <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000</span>)] <span class="comment"># 将程序停止指令放满整个指令集</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compile_addr2</span>(<span class="params">addr, ir, psw, index</span>): <span class="comment"># 处理二操作数的指令</span></span><br><span class="line">    <span class="keyword">global</span> micro</span><br><span class="line"></span><br><span class="line">    op = ir &amp; <span class="number">0xf0</span> <span class="comment"># 取出操作指令</span></span><br><span class="line">    amd = (ir &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span> <span class="comment"># 取出目标操作数的寻址方式</span></span><br><span class="line">    ams = ir &amp; <span class="number">3</span> <span class="comment"># 取出源操作数的寻址方式</span></span><br><span class="line"></span><br><span class="line">    INST = ASM.INSTRUCTIONS[<span class="number">2</span>] <span class="comment"># 取出二操作数的所有指令的列表</span></span><br><span class="line">    <span class="keyword">if</span> op <span class="keyword">not</span> <span class="keyword">in</span> INST:         <span class="comment"># 遍历二操作数的所有指令看存不存在，如果不存在</span></span><br><span class="line">        micro[addr] = pin.CYC <span class="comment"># 跳过该指令</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    am = (amd, ams) <span class="comment"># 目的操作数和源操作数合起来</span></span><br><span class="line">    <span class="keyword">if</span> am <span class="keyword">not</span> <span class="keyword">in</span> INST[op]: <span class="comment"># 遍历该指令下的所有寻址方式，如果不存在</span></span><br><span class="line">        micro[addr] = pin.CYC <span class="comment"># 跳过该指令</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    EXEC = INST[op][am] <span class="comment"># 假设指令和寻址方式都找到了，则拷贝出对应的微指令</span></span><br><span class="line">    <span class="keyword">if</span> index &lt; <span class="built_in">len</span>(EXEC): <span class="comment"># 把指令补到后面</span></span><br><span class="line">        micro[addr] = EXEC[index]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        micro[addr] = pin.CYC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compile_addr1</span>(<span class="params">addr, ir, psw, index</span>): <span class="comment"># 处理一操作数的指令</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compile_addr0</span>(<span class="params">addr, ir, psw, index</span>): <span class="comment"># 处理零操作数的指令</span></span><br><span class="line">    <span class="keyword">global</span> micro</span><br><span class="line"></span><br><span class="line">    op = ir <span class="comment"># 取出操作指令</span></span><br><span class="line"></span><br><span class="line">    INST = ASM.INSTRUCTIONS[<span class="number">0</span>] <span class="comment"># 取出零操作数的所有指令的列表</span></span><br><span class="line">    <span class="keyword">if</span> op <span class="keyword">not</span> <span class="keyword">in</span> INST: <span class="comment"># 遍历二操作数的所有指令看存不存在，如果不存在</span></span><br><span class="line">        micro[addr] = pin.CYC <span class="comment"># 跳过该指令</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    EXEC = INST[op] <span class="comment"># 假设指令找到了，则拷贝出对应的微指令</span></span><br><span class="line">    <span class="keyword">if</span> index &lt; <span class="built_in">len</span>(EXEC): <span class="comment"># 把指令补到后面</span></span><br><span class="line">        micro[addr] = EXEC[index]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        micro[addr] = pin.CYC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000</span>): <span class="comment"># 对整个指令集依次处理</span></span><br><span class="line">    ir = addr &gt;&gt; <span class="number">8</span>            <span class="comment"># 取出表示指令的一段</span></span><br><span class="line">    psw = (addr &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>   <span class="comment"># 取出表示状态字的一段</span></span><br><span class="line">    cyc = addr &amp; <span class="number">0xf</span>          <span class="comment"># 取出微指令周期的一段</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cyc &lt; <span class="built_in">len</span>(ASM.FETCH): <span class="comment"># 这里是将一段取值微程序放到所有指令中</span></span><br><span class="line">        micro[addr] = ASM.FETCH[cyc]</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    addr2 = ir &amp; (<span class="number">1</span> &lt;&lt; <span class="number">7</span>)    <span class="comment"># 取出表示二操作数指令的位</span></span><br><span class="line">    addr1 = ir &amp; (<span class="number">1</span> &lt;&lt; <span class="number">6</span>)    <span class="comment"># 取出表示一操作数指令的位</span></span><br><span class="line"></span><br><span class="line">    index = cyc - <span class="built_in">len</span>(ASM.FETCH) <span class="comment"># ASM.FETCH已经有6个指令</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> addr2: <span class="comment"># 对操作数不同的指令分情况处理</span></span><br><span class="line">        compile_addr2(addr, ir, psw, index)</span><br><span class="line">    <span class="keyword">elif</span> addr1:</span><br><span class="line">        compile_addr1(addr, ir, psw, index)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        compile_addr0(addr, ir, psw, index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> micro:</span><br><span class="line">        value = var.to_bytes(<span class="number">4</span>, byteorder=<span class="string">'little'</span>)</span><br><span class="line">        file.write(value)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Compile micro instruction finish!!!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将编译完后的指令集下载到ROM里</p>
<p>现在我们手动往RAM里写程序</p>
<p><code>MOV A,5</code> 机器码 <code>84 08 05</code><br><code>HLT</code>          机器码 <code>3F</code></p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/17.png" class="">


<p>启动运行</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/18.png" class="">

<p>但是这里还没有实现汇编的编译器，所以看下一节</p>
<h3 id="汇编编译器"><a href="#汇编编译器" class="headerlink" title="汇编编译器"></a>汇编编译器</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/28%20%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8">28 汇编编译器</a></strong></em></p>
<blockquote>
<p>本节来写一下编译器，实现将汇编指令翻译成机器语言</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pin</span><br><span class="line"><span class="keyword">import</span> assembly <span class="keyword">as</span> ASM</span><br><span class="line"></span><br><span class="line">dirname = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line">inputfile = os.path.join(dirname, <span class="string">'program.asm'</span>) <span class="comment"># 读入汇编文件</span></span><br><span class="line">outputfile = os.path.join(dirname, <span class="string">'program.bin'</span>)</span><br><span class="line"></span><br><span class="line">annotation = re.<span class="built_in">compile</span>(<span class="string">r"(.*?);.*"</span>) <span class="comment"># 正则匹配</span></span><br><span class="line"></span><br><span class="line">codes = []</span><br><span class="line"></span><br><span class="line">OP2 = { <span class="comment"># 二操作数指令列表</span></span><br><span class="line">    <span class="string">'MOV'</span>: ASM.MOV</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">OP1 = { <span class="comment"># 一操作数指令列表</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">OP0 = { <span class="comment"># 零操作数指令列表</span></span><br><span class="line">    <span class="string">'NOP'</span>: ASM.NOP,</span><br><span class="line">    <span class="string">'HLT'</span>: ASM.HLT,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">OP2SET = <span class="built_in">set</span>(OP2.values()) </span><br><span class="line">OP1SET = <span class="built_in">set</span>(OP1.values())</span><br><span class="line">OP0SET = <span class="built_in">set</span>(OP0.values())</span><br><span class="line"></span><br><span class="line">REGISTERS = { <span class="comment"># 可操作寄存器</span></span><br><span class="line">    <span class="string">"A"</span>: pin.A,</span><br><span class="line">    <span class="string">"B"</span>: pin.B,</span><br><span class="line">    <span class="string">"C"</span>: pin.C,</span><br><span class="line">    <span class="string">"D"</span>: pin.D,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Code</span>(<span class="title class_ inherited__">object</span>): <span class="comment"># Code对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, number, source</span>):</span><br><span class="line">        <span class="variable language_">self</span>.numer = number <span class="comment"># 行号</span></span><br><span class="line">        <span class="variable language_">self</span>.source = source.upper() <span class="comment"># 源代码</span></span><br><span class="line">        <span class="variable language_">self</span>.op = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.dst = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.src = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.prepare_source() <span class="comment"># 调用预处理源代码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_op</span>(<span class="params">self</span>): <span class="comment"># 获取指令</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.op <span class="keyword">in</span> OP2:</span><br><span class="line">            <span class="keyword">return</span> OP2[<span class="variable language_">self</span>.op]</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.op <span class="keyword">in</span> OP1:</span><br><span class="line">            <span class="keyword">return</span> OP1[<span class="variable language_">self</span>.op]</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.op <span class="keyword">in</span> OP0:</span><br><span class="line">            <span class="keyword">return</span> OP0[<span class="variable language_">self</span>.op]</span><br><span class="line">        <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_am</span>(<span class="params">self, addr</span>): <span class="comment"># 获取目的 操作数和源操作数</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> addr: <span class="comment"># 如果啥都没有，返回0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> addr <span class="keyword">in</span> REGISTERS: <span class="comment"># 如果是寄存器，列表中存在返回寄存器编码</span></span><br><span class="line">            <span class="keyword">return</span> pin.AM_REG, REGISTERS[addr]</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">r'^[0-9]+$'</span>, addr): <span class="comment"># 如果是数字，返回立即数</span></span><br><span class="line">            <span class="keyword">return</span> pin.AM_INS, <span class="built_in">int</span>(addr)</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">r'^0X[0-9A-F]+$'</span>, addr): <span class="comment"># 如果是十六进制数，返回十六进制立即数</span></span><br><span class="line">            <span class="keyword">return</span> pin.AM_INS, <span class="built_in">int</span>(addr, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prepare_source</span>(<span class="params">self</span>): <span class="comment"># 预处理源代码</span></span><br><span class="line">        tup = <span class="variable language_">self</span>.source.split(<span class="string">','</span>) <span class="comment"># 用逗号分割代码</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) &gt; <span class="number">2</span>: <span class="comment"># 如果分割出来长度大于2 说明语法错误</span></span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) == <span class="number">2</span>: <span class="comment"># 如果分割出来等于二</span></span><br><span class="line">            <span class="variable language_">self</span>.src = tup[<span class="number">1</span>].strip() <span class="comment"># 把逗号后面的分配给源操作数</span></span><br><span class="line"></span><br><span class="line">        tup = re.split(<span class="string">r" +"</span>, tup[<span class="number">0</span>]) <span class="comment"># 用正则空格来分割</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) &gt; <span class="number">2</span>: <span class="comment"># 如果分割出来长度大于2 说明语法错误</span></span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) == <span class="number">2</span>: <span class="comment"># 如果等于二</span></span><br><span class="line">            <span class="variable language_">self</span>.dst = tup[<span class="number">1</span>].strip() <span class="comment"># 将后面的分配给目的操作数</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.op = tup[<span class="number">0</span>].strip() <span class="comment"># 前面的分配给指令</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compile_code</span>(<span class="params">self</span>):</span><br><span class="line">        op = <span class="variable language_">self</span>.get_op() <span class="comment"># 获取指令</span></span><br><span class="line"></span><br><span class="line">        amd, dst = <span class="variable language_">self</span>.get_am(<span class="variable language_">self</span>.dst) <span class="comment"># 获取目的操作数编码</span></span><br><span class="line">        ams, src = <span class="variable language_">self</span>.get_am(<span class="variable language_">self</span>.src) <span class="comment"># 获取源操作数编码</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> op <span class="keyword">in</span> OP2SET: <span class="comment"># 获取指令编码</span></span><br><span class="line">            ir = op | (amd &lt;&lt; <span class="number">2</span>) | ams</span><br><span class="line">        <span class="keyword">elif</span> op <span class="keyword">in</span> OP1SET:</span><br><span class="line">            ir = op | amd</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ir = op</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [ir, dst, src]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>): <span class="comment"># 打印的时候显示</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'[<span class="subst">{self.numer}</span>] - <span class="subst">{self.source}</span>'</span> <span class="comment"># 显示行号+源代码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SyntaxError</span>(<span class="title class_ inherited__">Exception</span>): <span class="comment"># 语法错误</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, code: Code, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kwargs)</span><br><span class="line">        <span class="variable language_">self</span>.code = code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compile_program</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(inputfile, encoding=<span class="string">'utf8'</span>) <span class="keyword">as</span> file: <span class="comment"># 读入汇编文件</span></span><br><span class="line">        lines = file.readlines() <span class="comment"># 记录行号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(lines):</span><br><span class="line">        source = line.strip() <span class="comment"># 将两端的空格去掉</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">';'</span> <span class="keyword">in</span> source: <span class="comment"># 将;后面的去掉</span></span><br><span class="line">            <span class="keyword">match</span> = annotation.<span class="keyword">match</span>(source)</span><br><span class="line">            source = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> source: <span class="comment"># 如果没有代码跳过</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        code = Code(index + <span class="number">1</span>, source) <span class="comment"># 生成Code类对源代码进行处理</span></span><br><span class="line">        codes.append(code)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(outputfile, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> code <span class="keyword">in</span> codes:</span><br><span class="line">            values = code.compile_code() <span class="comment"># 获得 编码</span></span><br><span class="line">            <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">                result = value.to_bytes(<span class="number">1</span>, byteorder=<span class="string">'little'</span>)</span><br><span class="line">                file.write(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    compile_program()</span><br><span class="line">    <span class="comment"># try:</span></span><br><span class="line">    <span class="comment">#     compile_program()</span></span><br><span class="line">    <span class="comment"># except SyntaxError as e:</span></span><br><span class="line">    <span class="comment">#     print(f'Syntax error at {e.code}')</span></span><br><span class="line">    <span class="comment">#     return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'compile program.asm finished!!!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>asm</code>文件里写入以下程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MOV A, 5; this is annotation</span><br><span class="line"></span><br><span class="line">MOV A, 5</span><br><span class="line"></span><br><span class="line">MOV B, 10;</span><br><span class="line"></span><br><span class="line">MOV C, 11;</span><br><span class="line"></span><br><span class="line">MOV A, 0x30;</span><br><span class="line"></span><br><span class="line">MOV D, 0x30;</span><br><span class="line"></span><br><span class="line">hlt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>启动编译器，我们得到bin文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">84 08 05 84 08 05 84 09 0A 84 0A 0B 84 08 30 84 0B 30 3F 00 00</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>84 08 05</code> ：<code>MOV A, 5</code></p>
<ul>
<li><code>84 = 1000 0100</code> ：<code>MOV 寄存器寻址，立即数寻址</code></li>
<li><code>08</code>：寄存器A的编码</li>
<li><code>05</code>：立即数5</li>
</ul>
</li>
<li><p><code>84 08 05</code></p>
</li>
<li><p><code>84 09 0A</code>：<code>MOV B, 10</code></p>
<ul>
<li><code>84 = 1000 0100</code> ：<code>MOV 寄存器寻址，立即数寻址</code></li>
<li><code>09</code>：寄存器B的编码</li>
<li><code>0A</code>：立即数10</li>
</ul>
</li>
<li><p><code>84 0A 0B</code>：<code>MOV C, 11</code></p>
<ul>
<li><code>84 = 1000 0100</code> ：<code>MOV 寄存器寻址，立即数寻址</code></li>
<li><code>0A</code>：寄存器C的编码</li>
<li><code>0B</code>：立即数11</li>
</ul>
</li>
<li><p><code>84 08 30</code>：<code>MOV A, 0x30</code></p>
<ul>
<li><code>84 = 1000 0100</code> ：<code>MOV 寄存器寻址，立即数寻址</code></li>
<li><code>08</code>：寄存器A的编码</li>
<li><code>30</code>：立即数十六进制0x30</li>
</ul>
</li>
<li><p><code>84 08 30</code>：<code>MOV A, 0x30</code></p>
<ul>
<li><code>84 = 1000 0100</code> ：<code>MOV 寄存器寻址，立即数寻址</code></li>
<li><code>08</code>：寄存器A的编码</li>
<li><code>30</code>：立即数十六进制0x30</li>
</ul>
</li>
<li><p><code>84 0B 30</code>：<code>MOV A, 0x30</code></p>
<ul>
<li><code>84 = 1000 0100</code> ：<code>MOV 寄存器寻址，立即数寻址</code></li>
<li><code>0B</code>：寄存器D的编码</li>
<li><code>30</code>：立即数十六进制0x30</li>
</ul>
</li>
<li><p><code>3F</code>：指令<code>hlt</code>的编号</p>
</li>
</ul>
<p>将汇编编译过后的<code>bin</code>文件导入，运行</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/19.png" class="">





<h3 id="数据传送指令"><a href="#数据传送指令" class="headerlink" title="数据传送指令"></a>数据传送指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/29%20%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A4">29 数据传送指令</a></strong></em></p>
<blockquote>
<p>这一节我们继续实现MOV指令的其他寻址方式</p>
</blockquote>
<ul>
<li>寄存器寻址，立即寻址</li>
<li>寄存器寻址，寄存器寻址</li>
<li>寄存器寻址，直接寻址</li>
<li>寄存器寻址，寄存器间接寻址</li>
<li>直接寻址，立即寻址</li>
<li>直接寻址，寄存器寻址</li>
<li>直接寻址，直接寻址</li>
<li>直接寻址，寄存器间接寻址</li>
<li>寄存器间接寻址，立即数寻址</li>
<li>寄存器间接寻址，寄存器寻址</li>
<li>寄存器间接寻址，直接寻址</li>
<li>寄存器间接寻址，寄存器间接寻址</li>
</ul>
<p>注：因为指令例如<code>MOV A,5</code> 的三个分别是读到<code>IR</code> ，<code>DST</code>，<code>SRC</code>三个寄存器里的，因此对于后两个寄存器<code>DST</code>，<code>SRC</code>有两个功能，一是直接读写寄存器的数据(这里我称为<code>寄存器读/写</code>)，二是通过寄存器里的数据代号间接读取或写入其他寄存器里的数值(这里我称为<code>读/写寄存器</code>)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">INSTRUCTIONS = {</span><br><span class="line">    <span class="number">2</span>: {</span><br><span class="line">        MOV: {</span><br><span class="line">            (pin.AM_REG, pin.AM_INS): [ <span class="comment"># (寄存器寻址，立即寻址) 例如 MOV A,5</span></span><br><span class="line">                pin.DST_W | pin.SRC_OUT, <span class="comment"># 微指令：DST写寄存器，SRC寄存器读，SRC-&gt;DST，读取SRC寄存器里数据送入DST指定的寄存器中</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_REG, pin.AM_REG): [ <span class="comment"># (寄存器寻址，寄存器寻址) 例如 MOV A,B</span></span><br><span class="line">                pin.DST_W | pin.SRC_R,  <span class="comment"># 微指令：DST写寄存器，SRC读寄存器，SRC-&gt;DST，这里DST，SRC是控制其他寄存器写和读</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_REG, pin.AM_DIR): [ <span class="comment"># (寄存器寻址，直接寻址) 例如 MOV A,[5]</span></span><br><span class="line">                pin.SRC_OUT | pin.MAR_IN, <span class="comment"># 从SRC寄存器读，送到RAM地址线上</span></span><br><span class="line">                pin.DST_W | pin.RAM_OUT <span class="comment"># 从RAM指定地址读，DST写寄存器</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_REG, pin.AM_RAM): [ <span class="comment"># (寄存器寻址，寄存器间接寻址) 例如 MOV A,[B]</span></span><br><span class="line">                pin.SRC_R | pin.MAR_IN, <span class="comment"># SRC读寄存器(数据)，送到RAM地址线上</span></span><br><span class="line">                pin.DST_W | pin.RAM_OUT <span class="comment"># 从RAM指定地址读数据，DST写寄存器</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_DIR, pin.AM_INS): [ <span class="comment"># (直接寻址，立即寻址) 例如 MOV [5],5</span></span><br><span class="line">                pin.DST_OUT | pin.MAR_IN, <span class="comment"># 从DST寄存器读数据，送到RAM地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.SRC_OUT <span class="comment"># 从SRC寄存器读数据，往RAM里写</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_DIR, pin.AM_REG): [ <span class="comment"># (直接寻址，寄存器寻址) 例如 MOV [5],A</span></span><br><span class="line">                pin.DST_OUT | pin.MAR_IN, <span class="comment"># DST寄存器读，送到地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.SRC_R, <span class="comment"># SRC读寄存器，往RAM里写</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_DIR, pin.AM_DIR): [ <span class="comment"># (直接寻址，直接寻址) 例如 MOV [5],[2]</span></span><br><span class="line">                pin.SRC_OUT | pin.MAR_IN, <span class="comment"># SRC寄存器读到地址线上</span></span><br><span class="line">                pin.RAM_OUT | pin.T1_IN, <span class="comment"># 从RAM里读出来，写到T1寄存器里</span></span><br><span class="line">                pin.DST_OUT | pin.MAR_IN, <span class="comment"># 再把DST寄存器读到地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.T1_OUT, <span class="comment"># 把T1寄存器的值写到RAM里</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_DIR, pin.AM_RAM): [ <span class="comment"># (直接寻址，寄存器间接寻址) 例如 MOV [5],[A]</span></span><br><span class="line">                pin.SRC_R | pin.MAR_IN, <span class="comment"># SRC读寄存器到地址线上</span></span><br><span class="line">                pin.RAM_OUT | pin.T1_IN, <span class="comment"># 把RAM数据读到T1上</span></span><br><span class="line">                pin.DST_OUT | pin.MAR_IN, <span class="comment"># DST寄存器读到地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.T1_OUT, <span class="comment"># 把T1写到RAM里</span></span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            (pin.AM_RAM, pin.AM_INS): [ <span class="comment"># (寄存器间接寻址，立即数寻址) 例如 MOV [A],5</span></span><br><span class="line">                pin.DST_R | pin.MAR_IN, <span class="comment"># DST读寄存器到地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.SRC_OUT <span class="comment"># SRC寄存器数据写到RAM里</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_RAM, pin.AM_REG): [ <span class="comment"># (寄存器间接寻址，寄存器寻址) 例如 MOV [A],B</span></span><br><span class="line">                pin.DST_R | pin.MAR_IN, <span class="comment"># DST读寄存器到地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.SRC_R, <span class="comment"># SRC读寄存器到RAM里</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_RAM, pin.AM_DIR): [ <span class="comment"># (寄存器间接寻址，直接寻址) 例如 MOV [A],[5]</span></span><br><span class="line">                pin.SRC_OUT | pin.MAR_IN, <span class="comment"># SRC寄存器的数据送到地址线上</span></span><br><span class="line">                pin.RAM_OUT | pin.T1_IN, <span class="comment"># RAM里数据读到T1里</span></span><br><span class="line">                pin.DST_R | pin.MAR_IN, <span class="comment"># DST读寄存器到地址总线上</span></span><br><span class="line">                pin.RAM_IN | pin.T1_OUT, <span class="comment"># 把T1读到RAM里</span></span><br><span class="line">            ],</span><br><span class="line">            (pin.AM_RAM, pin.AM_RAM): [ <span class="comment"># (寄存器间接寻址，寄存器间接寻址) 例如 MOV [A],[B]</span></span><br><span class="line">                pin.SRC_R | pin.MAR_IN, <span class="comment"># SRC读寄存器到地址线上</span></span><br><span class="line">                pin.RAM_OUT | pin.T1_IN, <span class="comment"># RAM输出到T1</span></span><br><span class="line">                pin.DST_R | pin.MAR_IN, <span class="comment">#  DST读寄存器到地址线上</span></span><br><span class="line">                pin.RAM_IN | pin.T1_OUT, <span class="comment"># T1输出到RAM</span></span><br><span class="line">            ]</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    <span class="number">1</span>: {},</span><br><span class="line">    <span class="number">0</span>: {</span><br><span class="line">        NOP: [</span><br><span class="line">            pin.CYC,</span><br><span class="line">        ],</span><br><span class="line">        HLT: [</span><br><span class="line">            pin.HLT,</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>将控制器编译完后载入到ROM中</p>
<p>编译器大致上差不多</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pin</span><br><span class="line"><span class="keyword">import</span> assembly <span class="keyword">as</span> ASM</span><br><span class="line"></span><br><span class="line">dirname = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line">inputfile = os.path.join(dirname, <span class="string">'program.asm'</span>)</span><br><span class="line">outputfile = os.path.join(dirname, <span class="string">'program.bin'</span>)</span><br><span class="line"></span><br><span class="line">annotation = re.<span class="built_in">compile</span>(<span class="string">r"(.*?);.*"</span>)</span><br><span class="line"></span><br><span class="line">codes = []</span><br><span class="line"></span><br><span class="line">OP2 = {</span><br><span class="line">    <span class="string">'MOV'</span>: ASM.MOV</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">OP1 = {</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">OP0 = {</span><br><span class="line">    <span class="string">'NOP'</span>: ASM.NOP,</span><br><span class="line">    <span class="string">'HLT'</span>: ASM.HLT,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">OP2SET = <span class="built_in">set</span>(OP2.values())</span><br><span class="line">OP1SET = <span class="built_in">set</span>(OP1.values())</span><br><span class="line">OP0SET = <span class="built_in">set</span>(OP0.values())</span><br><span class="line"></span><br><span class="line">REGISTERS = {</span><br><span class="line">    <span class="string">"A"</span>: pin.A,</span><br><span class="line">    <span class="string">"B"</span>: pin.B,</span><br><span class="line">    <span class="string">"C"</span>: pin.C,</span><br><span class="line">    <span class="string">"D"</span>: pin.D,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Code</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, number, source</span>):</span><br><span class="line">        <span class="variable language_">self</span>.numer = number</span><br><span class="line">        <span class="variable language_">self</span>.source = source.upper()</span><br><span class="line">        <span class="variable language_">self</span>.op = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.dst = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.src = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.prepare_source()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_op</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.op <span class="keyword">in</span> OP2:</span><br><span class="line">            <span class="keyword">return</span> OP2[<span class="variable language_">self</span>.op]</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.op <span class="keyword">in</span> OP1:</span><br><span class="line">            <span class="keyword">return</span> OP1[<span class="variable language_">self</span>.op]</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.op <span class="keyword">in</span> OP0:</span><br><span class="line">            <span class="keyword">return</span> OP0[<span class="variable language_">self</span>.op]</span><br><span class="line">        <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_am</span>(<span class="params">self, addr</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> addr:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> addr <span class="keyword">in</span> REGISTERS:</span><br><span class="line">            <span class="keyword">return</span> pin.AM_REG, REGISTERS[addr]</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">r'^[0-9]+$'</span>, addr):</span><br><span class="line">            <span class="keyword">return</span> pin.AM_INS, <span class="built_in">int</span>(addr)</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">r'^0X[0-9A-F]+$'</span>, addr):</span><br><span class="line">            <span class="keyword">return</span> pin.AM_INS, <span class="built_in">int</span>(addr, <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r'^\[([0-9]+)\]$'</span>, addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            <span class="keyword">return</span> pin.AM_DIR, <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r'^\[(0X[0-9A-F]+)\]$'</span>, addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            <span class="keyword">return</span> pin.AM_DIR, <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r'^\[(.+)\]$'</span>, addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span> <span class="keyword">and</span> <span class="keyword">match</span>.group(<span class="number">1</span>) <span class="keyword">in</span> REGISTERS:</span><br><span class="line">            <span class="keyword">return</span> pin.AM_RAM, REGISTERS[<span class="keyword">match</span>.group(<span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prepare_source</span>(<span class="params">self</span>):</span><br><span class="line">        tup = <span class="variable language_">self</span>.source.split(<span class="string">','</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) &gt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) == <span class="number">2</span>:</span><br><span class="line">            <span class="variable language_">self</span>.src = tup[<span class="number">1</span>].strip()</span><br><span class="line"></span><br><span class="line">        tup = re.split(<span class="string">r" +"</span>, tup[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) &gt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tup) == <span class="number">2</span>:</span><br><span class="line">            <span class="variable language_">self</span>.dst = tup[<span class="number">1</span>].strip()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.op = tup[<span class="number">0</span>].strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compile_code</span>(<span class="params">self</span>):</span><br><span class="line">        op = <span class="variable language_">self</span>.get_op()</span><br><span class="line"></span><br><span class="line">        amd, dst = <span class="variable language_">self</span>.get_am(<span class="variable language_">self</span>.dst)</span><br><span class="line">        ams, src = <span class="variable language_">self</span>.get_am(<span class="variable language_">self</span>.src)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> src <span class="keyword">and</span> (amd, ams) <span class="keyword">not</span> <span class="keyword">in</span> ASM.INSTRUCTIONS[<span class="number">2</span>][op]:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> src <span class="keyword">and</span> dst <span class="keyword">and</span> amd <span class="keyword">not</span> <span class="keyword">in</span> ASM.INSTRUCTIONS[<span class="number">1</span>][op]:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> src <span class="keyword">and</span> <span class="keyword">not</span> dst <span class="keyword">and</span> op <span class="keyword">not</span> <span class="keyword">in</span> ASM.INSTRUCTIONS[<span class="number">0</span>]:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> op <span class="keyword">in</span> OP2SET:</span><br><span class="line">            ir = op | (amd &lt;&lt; <span class="number">2</span>) | ams</span><br><span class="line">        <span class="keyword">elif</span> op <span class="keyword">in</span> OP1SET:</span><br><span class="line">            ir = op | amd</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ir = op</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [ir, dst, src]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'[<span class="subst">{self.numer}</span>] - <span class="subst">{self.source}</span>'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SyntaxError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, code: Code, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kwargs)</span><br><span class="line">        <span class="variable language_">self</span>.code = code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compile_program</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(inputfile, encoding=<span class="string">'utf8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        lines = file.readlines()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(lines):</span><br><span class="line">        source = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">';'</span> <span class="keyword">in</span> source:</span><br><span class="line">            <span class="keyword">match</span> = annotation.<span class="keyword">match</span>(source)</span><br><span class="line">            source = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> source:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        code = Code(index + <span class="number">1</span>, source)</span><br><span class="line">        codes.append(code)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(outputfile, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> code <span class="keyword">in</span> codes:</span><br><span class="line">            values = code.compile_code()</span><br><span class="line">            <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">                result = value.to_bytes(<span class="number">1</span>, byteorder=<span class="string">'little'</span>)</span><br><span class="line">                file.write(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        compile_program()</span><br><span class="line">    <span class="keyword">except</span> SyntaxError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'Syntax error at <span class="subst">{e.code}</span>'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'compile program.asm finished!!!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>写下测试指令</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; MOV C, 5;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV D, C;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV D, [5];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV A, 6;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV D, [A]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV [0x2f], 5;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV C, 0x18;</span></span><br><span class="line"><span class="comment">; MOV [0x2f], C;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV [0x2e], 18;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV [0x2f], [0x2e];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV [0x18], 0xfe</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV C, 0x18;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV D, 0x33;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; MOV [C], D;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MOV [<span class="number">0x30</span>]<span class="punctuation">,</span> <span class="number">0xee</span><span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">MOV D<span class="punctuation">,</span> <span class="number">0x30</span></span><br><span class="line"></span><br><span class="line">MOV C<span class="punctuation">,</span> <span class="number">0x18</span><span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">MOV [C]<span class="punctuation">,</span> [<span class="number">0x30</span>]<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">hlt<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure>

<p>编译，载入到RAM中运行</p>
<h3 id="算术运算指令"><a href="#算术运算指令" class="headerlink" title="算术运算指令"></a>算术运算指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/30%20%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4">30 算术运算指令</a></strong></em></p>
<p>我们需要给ALU添加加1和减1的运算，改进 ALU如下：</p>
<img data-src="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/20.png" class="">


<p>然后我们定义指令集里 所有运算微指令</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_OP_SHIFT = <span class="number">17</span></span><br><span class="line"></span><br><span class="line">OP_ADD = <span class="number">0</span></span><br><span class="line">OP_SUB = <span class="number">1</span> &lt;&lt; _OP_SHIFT</span><br><span class="line">OP_INC = <span class="number">2</span> &lt;&lt; _OP_SHIFT</span><br><span class="line">OP_DEC = <span class="number">3</span> &lt;&lt; _OP_SHIFT</span><br><span class="line">OP_AND = <span class="number">4</span> &lt;&lt; _OP_SHIFT</span><br><span class="line">OP_OR = <span class="number">5</span> &lt;&lt; _OP_SHIFT</span><br><span class="line">OP_XOR = <span class="number">6</span> &lt;&lt; _OP_SHIFT</span><br><span class="line">OP_NOT = <span class="number">7</span> &lt;&lt; _OP_SHIFT</span><br><span class="line"></span><br><span class="line">ALU_OUT = <span class="number">1</span> &lt;&lt; <span class="number">20</span></span><br><span class="line">ALU_PSW = <span class="number">1</span> &lt;&lt; <span class="number">21</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>汇编指令的编号和实现</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MOV = (<span class="number">0</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line">ADD = (<span class="number">1</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line">SUB = (<span class="number">2</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line"></span><br><span class="line">INC = (<span class="number">0</span> &lt;&lt; pin.ADDR1_SHIFT) | pin.ADDR1</span><br><span class="line">DEC = (<span class="number">1</span> &lt;&lt; pin.ADDR1_SHIFT) | pin.ADDR1</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ADD: {</span><br><span class="line">    (pin.AM_REG, pin.AM_INS): [ <span class="comment"># (寄存器寻址，直接寻址) 例如ADD A,5</span></span><br><span class="line">        pin.DST_R | pin.A_IN, <span class="comment"># DST读寄存器数据到A寄存器中</span></span><br><span class="line">        pin.SRC_OUT | pin.B_IN, <span class="comment"># SRC寄存器读数据到B寄存器中</span></span><br><span class="line">        pin.OP_ADD | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW <span class="comment">#选择加法 ，ALU输出，DST写寄存器，ALU状态字</span></span><br><span class="line">    ],</span><br><span class="line">    (pin.AM_REG, pin.AM_REG): [ <span class="comment"># (寄存器寻址，寄存器寻址) 例如ADD A,B</span></span><br><span class="line">        pin.DST_R | pin.A_IN, <span class="comment"># DST读寄存器到A寄存器</span></span><br><span class="line">        pin.SRC_R | pin.B_IN, <span class="comment"># SRC读寄存器到B寄存器</span></span><br><span class="line">        pin.OP_ADD | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW <span class="comment"># 加法，ALU输出，DST写寄存器，ALU状态字</span></span><br><span class="line">    ],</span><br><span class="line">},</span><br><span class="line">SUB: {</span><br><span class="line">    (pin.AM_REG, pin.AM_INS): [ <span class="comment"># (寄存器寻址，直接寻址) 例如 SUB A,5</span></span><br><span class="line">        pin.DST_R | pin.A_IN, <span class="comment"># DST读寄存器到A寄存器</span></span><br><span class="line">        pin.SRC_OUT | pin.B_IN, <span class="comment"># SRC寄存器读数据到B寄存器</span></span><br><span class="line">        pin.OP_SUB | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW <span class="comment"># 减法，ALU输出，DST写寄存器 ，ALU状态字</span></span><br><span class="line">    ],</span><br><span class="line">    (pin.AM_REG, pin.AM_REG): [ <span class="comment"># (寄存器寻址，寄存器寻址) 例如 SUB A,B</span></span><br><span class="line">        pin.DST_R | pin.A_IN, <span class="comment"># DST读寄存器到A寄存器</span></span><br><span class="line">        pin.SRC_R | pin.B_IN, <span class="comment"># SRC读寄存器到B寄存器</span></span><br><span class="line">        pin.OP_SUB | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW <span class="comment"># 减法，ALU输出，DST写寄存器，ALU状态字</span></span><br><span class="line">    ],</span><br><span class="line">},</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INC: {</span><br><span class="line">    pin.AM_REG: [</span><br><span class="line">        pin.DST_R | pin.A_IN, <span class="comment"># DST读寄存器到A寄存器</span></span><br><span class="line">        pin.OP_INC | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW <span class="comment"># +1，ALU输出，DST写寄存器，ALU状态字</span></span><br><span class="line">    ],</span><br><span class="line">},</span><br><span class="line">DEC: {</span><br><span class="line">    pin.AM_REG: [</span><br><span class="line">        pin.DST_R | pin.A_IN, <span class="comment"># DST读寄存器到A寄存器</span></span><br><span class="line">        pin.OP_DEC | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW <span class="comment"># -1，ALU输出，DST写寄存器，ALU状态字</span></span><br><span class="line">    ],</span><br><span class="line">},</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>写入汇编程序</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MOV</span> D, <span class="number">0</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">INC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">INC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">INC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">INC</span> D<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DEC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">DEC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">DEC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">DEC</span> D<span class="comment">;</span></span><br><span class="line"><span class="keyword">DEC</span> D<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HLT</span></span><br></pre></td></tr></table></figure>

<p>运行</p>
<h3 id="逻辑运算指令"><a href="#逻辑运算指令" class="headerlink" title="逻辑运算指令"></a>逻辑运算指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/30%20%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4">31 逻辑运算指令</a></strong></em></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CMP = (<span class="number">3</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line">AND = (<span class="number">4</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line">OR = (<span class="number">5</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line">XOR = (<span class="number">6</span> &lt;&lt; pin.ADDR2_SHIFT) | pin.ADDR2</span><br><span class="line"></span><br><span class="line">NOT = (<span class="number">1</span> &lt;&lt; pin.ADDR1_SHIFT) | pin.ADDR1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">CMP: {</span><br><span class="line">    (pin.AM_REG, pin.AM_INS): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_OUT | pin.B_IN,</span><br><span class="line">        pin.OP_SUB | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">    (pin.AM_REG, pin.AM_REG): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_R | pin.B_IN,</span><br><span class="line">        pin.OP_SUB | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">},</span><br><span class="line">AND: {</span><br><span class="line">    (pin.AM_REG, pin.AM_INS): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_OUT | pin.B_IN,</span><br><span class="line">        pin.OP_AND | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">    (pin.AM_REG, pin.AM_REG): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_R | pin.B_IN,</span><br><span class="line">        pin.OP_AND | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">},</span><br><span class="line">OR: {</span><br><span class="line">    (pin.AM_REG, pin.AM_INS): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_OUT | pin.B_IN,</span><br><span class="line">        pin.OP_OR | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">    (pin.AM_REG, pin.AM_REG): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_R | pin.B_IN,</span><br><span class="line">        pin.OP_OR | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">},</span><br><span class="line">XOR: {</span><br><span class="line">    (pin.AM_REG, pin.AM_INS): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_OUT | pin.B_IN,</span><br><span class="line">        pin.OP_XOR | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">    (pin.AM_REG, pin.AM_REG): [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.SRC_R | pin.B_IN,</span><br><span class="line">        pin.OP_XOR | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">},</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NOT: {</span><br><span class="line">    pin.AM_REG: [</span><br><span class="line">        pin.DST_R | pin.A_IN,</span><br><span class="line">        pin.OP_NOT | pin.ALU_OUT | pin.DST_W | pin.ALU_PSW</span><br><span class="line">    ],</span><br><span class="line">},</span><br></pre></td></tr></table></figure>






<h3 id="标记转移指令"><a href="#标记转移指令" class="headerlink" title="标记转移指令"></a>标记转移指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/32%20%E6%A0%87%E8%AE%B0%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4">32 标记转移指令</a></strong></em></p>
<p>JMP 跳转到标记点</p>
<p>重点是编译器的实现</p>
<h3 id="条件转移指令"><a href="#条件转移指令" class="headerlink" title="条件转移指令"></a>条件转移指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/33%20%E6%9D%A1%E4%BB%B6%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4">33 条件转移指令</a></strong></em></p>
<h3 id="堆栈操作指令"><a href="#堆栈操作指令" class="headerlink" title="堆栈操作指令"></a>堆栈操作指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/34%20%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4">34 堆栈操作指令</a></strong></em></p>
<h3 id="函数调用指令"><a href="#函数调用指令" class="headerlink" title="函数调用指令"></a>函数调用指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/35%20%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%8C%87%E4%BB%A4">35 函数调用指令</a></strong></em></p>
<h3 id="内中断指令"><a href="#内中断指令" class="headerlink" title="内中断指令"></a>内中断指令</h3><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/36%20%E5%86%85%E4%B8%AD%E6%96%AD%E6%8C%87%E4%BB%A4">36 内中断指令</a></strong></em></p>
<h2 id="勘误-奇偶校验位"><a href="#勘误-奇偶校验位" class="headerlink" title="勘误-奇偶校验位"></a>勘误-奇偶校验位</h2><p><em><strong>参考工程：<a target="_blank" rel="noopener" href="https://github.com/StevenBaby/computer/tree/main/cpu/Other">Other</a></strong></em></p>
<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><script src="https://fastly.jsdelivr.net/npm/d3@7"></script><script src="https://fastly.jsdelivr.net/npm/markmap-view@0.18.10"></script><script src="https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10"></script>
<link rel="stylesheet" href="/css/markmap.css">

<script src="/js/markmap.js"></script>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>StarAire
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://staraire.github.io/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC3%E9%83%A8%E5%88%86_CPU%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="《8位二进制CPU的设计和实现》第三部分 CPU指令系统的实现">http://staraire.github.io/2025/03/28/教程笔记/计算机/8位二进制CPU的设计和实现/第3部分_CPU指令系统的实现/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/03/28/%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA/8%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E7%AC%AC2%E9%83%A8%E5%88%86_CPU%E5%BE%AE%E6%9C%BA%E6%9E%B6%E6%9E%84%E7%9A%84%E5%AE%9E%E7%8E%B0/" rel="prev" title="《8位二进制CPU的设计和实现》第二部分 CPU微机架构的实现">
                  <i class="fa fa-angle-left"></i> 《8位二进制CPU的设计和实现》第二部分 CPU微机架构的实现
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">StarAire</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">35k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:08</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '32px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

</body>
</html>
